---
title: 'Helsingin asuntokaupat 2021'
date: 2022-01-15T15:32:14Z
lastmod: '2022-01-15'
tags: ['data-analyysi', 'stadin asunnot']
draft: false
summary: 'Muuan asuntov√§litysyritys haluaa kehitt√§√§ liiketoimintaansa ymm√§rt√§m√§ll√§ Helsingin asuntomarkkinoita paremmin. T√§ss√§ postauksessa selvitet√§√§n alusta loppuun, miten asuntomarkkinoista otetaan veljellinen niskalenkki.'
layout: PostSimple
---
<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![Housing_prices](/static/images/tilastokeskus_housing_prices.png)
</div>

## Johdanto
Asuntojen hintakehitys on puoltanut Etel√§-Suomen etua jo pidemm√§n aikaa (kuva vasemmalla). It√§-Suomen ollessa laskutrendiss√§, L√§nsi- ja Pohjoissuomen py√∂riess√§ nollapeliss√§, on Etel√§-Suomessa keskihinnat nousseet vuodesta 2015 noin 15 prosenttia.

Isoja kaupunkeja tarkasteltaessa, on Helsinki ehdoton hintakehityksen kuningas (kuva oikealla). Jopa siin√§ m√§√§rin, ett√§ [spekulaatio hintakuplasta on k√§ynyt kiivaana](https://keskustelu.kauppalehti.fi/5/i/keskustelu/thread.jspa?threadID=257923).

Kuplaa tai ei, vahvat nousutrendit kertovat siit√§, ett√§ ihmiset haluavat ostaa asuntoja Helsingist√§. Kysynt√§ on korkealla. Ja mik√§ useimmiten seuraa kysynt√§√§, on tarjonta.

Lukuisat kiinteist√∂nv√§litt√§j√§t kilpailevat asiakkaista, pyrkien tarjoamaan nopeinta v√§lityst√§, suurimpia unelmia, parasta hintaa tai tunnetuinta v√§litt√§j√§√§. [Yhden teorian](https://www.jstor.org/stable/1252069?seq=1#metadata_info_tab_contents) mukaan yrityksen kilpailuasema ei m√§√§rity sen mukaan mit√§ se tarjoaa itsess√§√§n, vaan sen mukaan miten se vertautuu muihin tarjoajiin. Siksi yrityksen tuleekin erottua edukseen 
1) Erikoistumalla tarjoamalla jotain parempaa kuin kilpailijat. Esimerkiksi myyvemm√§t myyj√§t, tehokkaampi kustannusrakenne, paremmat asiakaskanavat tai tunnettavuus kyseisill√§ markkinoilla
2) Tarjoamalla v√§hint√§√§n minimim√§√§r√§n, joka vaaditaan markkinoilla p√§rj√§√§miseen.

J√§lkimm√§iseen liittyy kiihtyviss√§ m√§√§rin datan k√§ytt√§minen liiketoiminnassa. Jos ei halua joutua [luovan tuhon](https://fi.wikipedia.org/wiki/Luova_tuho) tallomaksi, joutuu yritys jatkuvasti p√§ivitt√§m√§√§n toimintamallejaan p√§rj√§t√§kseen kilpailussa.

### Case
Muuan Helsingiss√§ toimiva asuntov√§litysyritys tarvitsee uutta perspektiivi√§ liiketoimintaansa. 

T√§m√§ uusi yritys on toiminut markkinoilla vasta hetken aikaa, ja on huomannut, ett√§ heid√§n myyj√§ns√§ arviot asuntojen hinnoista heittelev√§t suuresti. Henkil√∂kohtaiset mieltymykset sek√§ eroava tiet√§mys asuinalueiden v√§lill√§ johtavat hinta-arvioihin, jotka ovat liian korkealla tai liian matalalla. Liian korkeat hinnat her√§tt√§v√§t ep√§luottamusta asiakkaassa ja pidempi√§ myyntiaikoja, siin√§ miss√§ liian matalat hinnat pienent√§v√§t katteita sek√§ asiakkaalle ett√§ v√§litt√§j√§lle. 

He haluavat selvitt√§√§, voisiko asuntojen hintoja pyrki√§ selvitt√§m√§√§n datan avulla. 

T√§ss√§ postauksessa teemme kyseiselle yritykselle analyysin Helsingin asuntomarkkinoista seuraavilla vaiheilla:
1) Mit√§ halutaan tiet√§√§ ja miten se linkittyy yrityksen liiketoimintaan
2) Mist√§ l√∂yt√§√§ data ja miten se hankitaan
3) Miten data prosessoidaan k√§ytt√∂kelpoiseksi analyysiin
4) Ensivilkaisu dataan
5) Laadullinen visualisointi Tableaulla
6) Regressiomalli asuntojen hintojen ennustamiseen

## Mit√§ halutaan tiet√§√§?
Ensin meid√§n tulee selvitt√§√§ asiakkaan n√§k√∂kulma.

Yl√§k√§sitteen√§ on asiakasyrityksen tarve parantaa liiketoimintaansa. T√§ten mik√§ tahansa, joka voi tuoda arvoa asiakkaalle, on sellaista joka kannattaa pit√§√§ korvan takana analyysin eri vaiheissa. Odottamalla odottamatonta voidaan l√∂yt√§√§ ratkaisuja, jotka parantavat asiakkaan asemaa, ja voivat palkita my√∂s l√∂yt√§j√§ns√§.

Itse toimenkuvaan kuului ratkaista ongelma, jossa myyjien asuntoarvioissa oli liikaa heittoa. Heittoon olivat syyn√§ sek√§ eroava tiet√§mys asuinaluiden v√§lill√§, sek√§ henkil√∂kohtaiset mieltymykset. Ensimm√§inen pohjautuu siis tiedon ep√§symmetriaan ja toinen inhimillisen arvioinnin virheellisyyteen, [kognitiivisiin harhoihin](https://fi.wikipedia.org/wiki/Kognitiivinen_vinouma).

Se mit√§ haluamme siis parantaa, on **arvio asuntojen hinnoista**.

Ongelmaan on ensisilm√§yksell√§ kaksi vaihtoehtoa. Voimme joko
1) Tarjota visualisoitua tietoa, jota voidaan k√§ytt√§√§ hinta-arvioinnin apua, ns. *"[kuvaileva analytiikka](https://en.wikipedia.org/wiki/Descriptive_statistics)"*
2) Tarjota ennustavaa mallia asuntojen hinnasta, ns. *"[ennustava analytiikka](https://en.wikipedia.org/wiki/Predictive_analytics)"*

Kuvaileva analytiikka koostuisi siis oleellisista tiedoista, jotka olisivat visualisoitu helposti pureskeltavaan muotoon. Se toimisi lis√§resurssina, jolla myyjien tiedon ep√§symmetriaa ja kognitiivisa harhoja voitaisiin v√§hent√§√§. Mahdollisia sudenkuoppia voisi kuitenkin olla, jos myyj√§t eiv√§t k√§ytt√§isi resurssia ja/tai tieto olisi visualisoitu ep√§selke√§sti.

Ennustava malli voisi puolestaan tarjota koneopetetun mallin, joka ennustaisi hinnan asunnon ominaisuuksien perusteella. Ennustavan mallin hinta-arvioiden virheet tulisi kuitenkin olla pienempi√§ kuin myyjien arvio-virheet ollakseen hy√∂dyllinen. Sen lis√§ksi ennakoivat mallit voivat niputtaa "erikoiset tapaukset", samaan malliin muiden kanssa tarjoten liian matalaa hintaa.

Haluamme siis visualisoida sek√§ ennustaa asuntojen hintoja riitt√§v√§n yksinkertaisesti, ett√§ ne ovat helposti saatavilla, kuitenkin ollessa riitt√§v√§n kattavia, jotta niist√§ voidaan saada hy√∂ty√§ l√§ht√∂tilanteeseen n√§hden.

## Mist√§ l√∂yt√§√§ data ja miten se hankitaan
Tarvitsemme siis tietoa asuntojen hinnoista, sek√§ asuntojen ominaisuuksista. Ensimm√§inen on riippuva muuttuja ja j√§lkimm√§iset riippumattomattomia muuttujia.

Koska asiakasyrityksell√§ ei ole tietoa asuntojen kaupoista, tulee tieto l√∂yt√§√§ netist√§. 

Hetken googleteltua, seuraavat vaihtoehdot hahmottuvat:
1) Tiedon hankkiminen avoimista tietokannoista, kuten tilastokeskuksen [Paavo](https://www.stat.fi/org/avoindata/paikkatietoaineistot/paavo.html)
2) Tiedon ostaminen kolmansilta osapuolilta. Esimerkiksi [Asuntojenhinnat](https://www.asuntojenhinnat.fi/myytyjen-asuntojen-tilastot) on selv√§sti ker√§nnyt dataa kauppojen hinnoista
3) Tiedon "raapiminen" (eng. [web crawling](https://en.wikipedia.org/wiki/Web_crawler)) sivustoilta, jossa haluamaamme tietoa n√§ytet√§√§n

N√§ist√§ ensimm√§inen olisi houkutteleva vaihtoehto tutkiessa hintakehitysta asuinalueilla, mutta siell√§ on vain keskiarvoja hintakehityksest√§. N√§in niiden listaaminen sopisi asuinalueiden yleisen hintakehityksen visualisoinnissa, kuten [Reaktorin esimerkiss√§](https://kannattaakokauppa.fi/), muttei yksitt√§isten asuntojen hinnan arvioinnissa.

Toinen torjutaan jo pelk√§st√§√§n hinnan takia. Tiedon kaupallistamisesta on tullut kasvava bisnes, jossa rajapintoja tarjotaan maksua vasten. Mutta me emme t√§ll√§ kertaa kontribuoi tuolle markkinalle.

Paras vaihtoehto on siis ohjelmallisesti raapia tieto sit√§ n√§ytt√§vilt√§ verkkosivuilta. 

[Asuntojen hintatiedot](https://asuntojen.hintatiedot.fi/haku/) on Ymp√§rist√∂ministeri√∂n yll√§pit√§m√§ sivusto, johon ilmoitetaan viimeisen vuoden sis√§ll√§ tapahtuneet asuntokaupat.

Emme mene raapimiseen sen syvemm√§lle t√§ss√§ postauksessa, mutta voit katsoa sen halutessasi kokonaisuudessaan [t√§st√§ notebookista](https://colab.research.google.com/drive/1l0pv0WTBHFGEoMahF1oAX2dCTp-abHEW#scrollTo=uEhrgjb5y7U6).

[T√§ss√§ yksi hyv√§ materiaali](https://realpython.com/beautiful-soup-web-scraper-python/) raapimisen opetteluun Pythonilla k√§ytt√§en beautifulsoup kirjastoa.

## Miten data prosessoidaan k√§ytt√∂kelpoiseksi
T√§ll√§ hetkell√§ tieto on likaista, eik√§ sit√§ voi viel√§ k√§ytt√§√§ visualisoinnissa tai ennustamisessa. Siksi meid√§n tulee puhdistaa ja prosessoida data, ennenkuin voimme k√§ytt√§√§ sit√§ malleissa.

[Datapuhdistus kokonaisuudessaan.](https://colab.research.google.com/drive/1xsxhXMUwH-Oo0OyuqYpjX7mhXH5i0YC0?usp=sharing)

L√§ht√∂kohta:
<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![likainen_data](/static/images/likainen_data.png)
</div>

Pari taikatemppua my√∂hemmin:
<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![puhdistettu_data](/static/images/puhdistettu_data.png)
</div>

Kuten huomataan, tietoa on tullut monta rivi√§ lis√§√§. T√§m√§ on tarkoituksellista. Haluamme s√§ilytt√§√§ alkuper√§iset nimikkeet, jotta my√∂hemmin datan kanssa ty√∂skentelt√§ess√§ voimme tehd√§ erinlaisia valintoja prosessoinnin suhteen.

Ai niin, ja mik√§ siin√§ sitten siis muuttui?
1) Kaupunginosien nimiss√§ oli virheit√§, suurin osa virheist√§ korjattiin etsim√§ll√§ kirjoitusvirheit√§ ja luokittelemalla useiden nimien l√∂ytyess√§ ne suurimpaan ryhm√§√§n
2) Neli√∂t muutettiin "string" => "int", ja samalla pilkku vaihtui pisteeksi
3) Ryhmiteltiin asunnot vuosikymmenien perusteilla ik√§ryhmiin
4) Muutettiin kunto categorisesta numeeriseksi
5) Paloiteltiin kerros-kolumni sek√§ kerros, ett√§ maksimi kerros kolumniin
6) Hissi & tontti totuusarvomuuttujiksi
7) Nimettiin columnit osuvammilla nimill√§

Kuvasta ei n√§y, mutta Tableauun siirtyess√§ kaupunginosat eiv√§t m√§ts√§nneet postinumeroiden kanssa, joten [ne tuli yhdist√§√§ Paavo-tietokannasta saatuihin postinumero-nimiin](https://colab.research.google.com/drive/1jo0D-qwjEotWhzRsEsnte68mWykKyxb9?usp=sharing).

Ennustavaan malliin categoriset muuttujat, kuten asuinpaikka, tulee viel√§ muuttaa ["dummy"-muuttujiksi](https://en.wikipedia.org/wiki/Dummy_variable_(statistics)), mutta tehd√§√§n se vasta ennustavan mallin rakentamisen yhteydess√§.

## Ensivilkaisu dataan

EDA (Explanatory Data Analysis) on prosessi, jossa dataa aletaan kuulustelemaan. Silt√§ kysell√§√§n polttavia kysymyksi√§ korrelaatioista, suhteista, keskiarvoista, mediaaneista ja mist√§ tahansa, joka pystyy hahmottamaan t√§rkeimpi√§ yhteyksi√§ ja ominaisuuksia datasta.

Alustavasti teemme EDA:n pythonilla, hy√∂dynt√§en kirjastoja kuten seaborn ja matplot. Se antaa meille suuntaviivat, joita l√§hdemme sen j√§lkeen tarkentamaan Tableaulla ja ennustavalla mallilla.

Prosessi kokonaisuudessaan [t√§√§ll√§](https://colab.research.google.com/drive/1qRXH_HX_-mufP1ap_qs8r_3WOYheN0rS?usp=sharing), mutta k√§ymme t√§ss√§ l√§pi keskeisimm√§t l√∂yd√∂t.

### Korrelaatiomatriisi
Korrelaatiomatriisia katsoessa n√§√§mme ristiinkorrelaatiot muuttujien v√§lill√§.

<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![korrelaatiot](/static/images/korrelaatiot.png)
</div>

Hinnan kanssa vahvasti korreloi l√§hinn√§ neli√∂t, ja euroa per neli√∂.

Paremmin n√§emme neli√∂hinnan perusteella (joka on hinta skaalattuna kokoon), miten muut muuttujat vaikuttavat asuntojen neli√∂hintaan. Kuntoa lukuunottamatta muut muuttujat korreloivat verrattain vahvasti (0.3 - 0.4) neli√∂hinnan kanssa.

### Asuinalueiden hintaerot 

Kuten olettaa saattaa, asuinalueiden v√§lill√§ on huomattavia eroja. Niit√§ l√∂ytyy niin neli√∂hinnan, hinnan kuin n√§iden keskihajonnankin perusteella.

<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![asuinalue_hintaerot](/static/images/asuinalue_hintaerot.png)
</div>

Kallion ja Tapulinkaupungin v√§lill√§ on suurta eroa: ensimm√§isess√§ neli√∂hinnat vaihtelevat jopa 4 tuhatta euroa, ja hinnat ylettyv√§t n. 250 tuhannesta 2 miljoonaan. Toisessa neli√∂hinnat asettuvat n. 1800-3200 euron v√§lille, hintojen ollessa l√§hell√§ toisiaan. T√§m√§n perusteella huomaamme my√∂s, ett√§ hintojen hajonta on suurta kaupunginalueiden v√§lill√§.


<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![asuinalueiden_erot_boxsplot](/static/images/asuinalueiden_erot_boxsplot.png)
</div>

Postinumeroilla jaetut box-plotit kertovat saman tarinan visuaalisesti puhuttelevassa muodossa. Ne n√§ytt√§v√§t mediaanihintojen vaihtelevan merkitt√§v√§sti alueittain, mutta ne my√∂s visualisoivat vaihteluv√§lin, sek√§ poikkeavat havainnot.

### Asunnon ik√§

<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![asunnon_ik√§](/static/images/asunnon_ik√§.png)
</div>

Asunnon neli√∂hinta on alimmillaan 1970-1990 luvulla rakennetuilla asunnoilla. 1950 ja sit√§ vanhemmat asunnot n√§ytt√§v√§t kasvattavan arvoaan vanhetessaan. Tosin t√§m√§ ei v√§ltt√§m√§tt√§ johdu hinnasta: vanhempia asuntoja voi esiinty√§ enemm√§n kalliilla keskustan alueilla, tai tiettyin√§ vuosikymmenin√§ on voitu rakentaa enemm√§n l√§hi√∂ihin.

### Talotyyppi, hissi ja tontti 

<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![ht_e_so](/static/images/ht_e_so.png)
</div>

### Havainnot
- Asuinalue vaikuttaa hintaan, neli√∂hintaan sek√§ n√§iden hajontaan
- Asunnon ik√§ korreloi sen neli√∂hinnan kanssa
- Talotyyppi, hissi sek√§ omistettu tontti vaikuttavat asunnon neli√∂hintaan
- Kerroksilla, maksimikerroksilla ja kunnolla ei n√§ytt√§isi olevan erityisen suurta vaikutusta neli√∂hintaan

## Laadullinen visualisointi Tableulla

Aiemmin k√§yty EDA loi meille linssin, jonka kautta l√§hesty√§ datan tutkimista. Sen perusteella loimme Tableau taulukon, jossa pystyy tarkkailemaan asuinalueiden eroja perustuen niiden: 
* Hintaan, keskihintaan ja keskineli√∂ihin, sek√§ n√§iden jakaantumiseen
* Kyseisen alueen talotyyppijakaumaan
* Ik√§jakaumaan

Kartalle visualisointi auttaa my√∂s hahmottamaan, miten neli√∂hinnat ovat korkeammat keskustassa ja halventuvat mit√§ kauemmas menn√§√§n.

<div className="my-1 px-2 w-full overflow-hidden xl:my-1 xl:px-2 xl:w-1/2">
    ![tableau_table](/static/images/tableau_table.png)
</div>

P√§√§set leikkim√§√§n taulukolla [t√§√§ll√§](https://public.tableau.com/app/profile/aleksi.kilponen/viz/Helsinkiapartmentprices2021/Dashboard1).

## Regressiomalli

üöß Regressiomalli dokumentoidaan l√§hitulevaisuudessa üöß

